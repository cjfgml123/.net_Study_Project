### 1. TCP/IP 스택

- 컴퓨터끼리 네트워크에서 데이터를 주고받기 위해서는  그 네트워크에서 통용되는 "프로토콜protocol"을 따라야 한다. 프로토콜은 규약, 규칙이라는 뜻으로 데이터를 주고 받기 위한 "통신 규약"을 말한다.

|애플리케이션 계층 |

|전송 계층				|

|인터넷 계층 		   |

|링크 계층                |

- TCP/IP는 다음 그림과 같이 크게 네 개의 계층으로 구성, 이것을 TCP/IP 스택 이라고 부르기도 한다.
- 일상에서 사용하는 웹 브라우저, 인스턴트 메신저, 팟캐스트 서비스의 데이터들이 모두 이 4계층을 오르내리고 있다.



#### 1.1 링크 계층(Link Layer)

- 물리 계층, 네트워크 접속 계층, 미디어 접근 계층 으로 불리기도 한다.
- RFC(Request For Comment)의견 요청서의 약자로 IETF(인터넷국제표준화기구)에 의해 발행되는 메모를 말한다.
- TCP/IP는 네트워크의 물리적인 구성으로 부터 독립적인 프로토콜인데 링크 계층에서 네트워크의 물리적인 연결 매체를 통해 패킷을 주고받는 작업을 담당해주기 때문
  - 패킷(Packet) - 네트워크를 통해 오고 가는 데이터를 일컬어 패킷이라고 부른다.
  - 패킷 = 내용물(데이터) + 포장지(주소) , 데이터를 보호하고 어디에서 어디로 가는지를 기입해야함. 이렇게 포장지로 포장된 데이터를 일컬어 "패킷"이라고 부른다.

- 네트워크 패킷은 4개의 계층이 모두 패킷의 포장지로 
  - 데이터를 보낼때 애플리케이션 -> 전송 -> 인터넷 -> 링크 계층까지 포장
  - 데이터를 받을때 링크->인터넷->전송->애플리케이션 계층까지 포장을 뜯어 내야함.

- ex) Ethernet, wifi, wibro, adsl , cable model

#### 1.2 인터넷 계층

- 패킷을 수신해야 할 상대의 주소를 지정하고, 나가는 패킷에 대해서 적절한 크기로 분할하며 들어오는 패킷에 대해서는 재조립을 수행한다. 
- 이 계층에서 사용되는 규약이 인터넷 프로토콜(IP)
- 내보낸 패킷을 상대방이 잘 수령했는지에 대해 보장하지 않는다.
- 그저 전송 계층에서 내려온 패킷에 주소를 붙여 네트워크 계층으로 보내기만 한다.



#### 1.3 전송 계층(Transport Layer)

- 패킷의 "운송"을 담당하는 프로토콜들이 정의되어 있다.
- 전송 제어 프로토콜(Transmission Control Protocol)은 송신 측과 수신 측 간의 연결성을 제공하며, 신뢰할 수 있는 패킷 전송 서비스를 제공한다.
- 여러 개의 패킷을 송신하는 경우 패킷 사이의 순서를 보장하며, 패킷이 유실되기라도 하면 재전송을 해주기 까지 한다.
- TCP는 IP가 제공하지 않는 연결성, 신뢰성을 제공한다.
  - 데이터가 큰 경우에는 여러 개의 패킷에 나눠 담아 순서대로 보내야 하지만, 데이터가 충분히 작은 경우에는 하나의 패킷에 담아 보내도 된다. 이런 상황에서는 TCP가 제공하는 패킷의 순서 보장성이 필요 없다. 또한 받아도 그만 , 안받아도 그만인 패킷의 경우에는 굳이 재전송할 필요가 없다. 즉 충분히 작고 전송 신뢰성을 요구하지 않는 데이터의 경우 TCP의 장점은 단점이 된다.
- 이를 위한 대안으로 UDP는 연결성, 신뢰성을 제공하지 않지만 TCP에 비해 성능이 우수하여 전송 제어를 직접 처리하는 애플리케이션 수준에서 채용되는 경우가 많다.



#### 1.4 애플리케이션 계층

- 각 응용 프로그램 나름의 프로토콜들이 정의되는 곳
  - 웹문서를 주고 받기 위한 HTTP(Hyper Text Transfer Protocol)
  - 파일 교환을 위한 FTP(File Transfer Protocol)
  - 네트워크 관리를 위한 SNMP(Simple Network Management Protocol)
- HTTP와 FTP는 상대적으로 큰 데이터를 처리해야 하기 때문에 연결성과 신뢰성을 제공하는 TCP에 기반하고 있고, SNMP는 단순한 정보만 다루는 데다 패킷을 일부 유실한다 해도 임무에 지장을 주지 않기 때문에 비용이 저렴한 UDP에 기반한다.
- HTTP나 FTP처럼 표준화된 프로토콜이 아니라도, 이 계층에서는 우리도 나름대로의 프로토콜을 정의해서 사용할 수 있다. 나만의 인스턴트 메신저를 개발하는 데 필요한 프로토콜을 정의하면 이 프로토콜은 이곳 애플리케이션 계층에 속한다.



#### 2. TCP/IP의 주소 체계 : IP주소

- 우편배달부가 우편물을 보낼때 주소가 필요한데 인터넷에서도 패킷을 배달하려면 주소가 필요하다. 이 주소를 IP주소라고 부른다.
- 현재 IPv4주소에서 IPv6로 인터넷 주소 체계가 잡히고 있다.



#### 3. 포트

- 큰 빌딩이 출입구가 여러 개 있는 것 처럼 컴퓨터도 네트워크 패킷이 드나들려면 "주소"뿐만 아니라 출입문이 필요한데 이 출입문을 포트(port)라고 부른다.
- 부호가 없는 16비트 정수로 0~65535 사이의 값을 이용한다.
- 표준 프로토콜이 사용하고 있는 포트 번호는 전 세계적으로 합의된 값이다. 이러한 포트 번호를 일컬어 "잘 알려진 포트 번호"라고 부른다.
  - HTTP : 80 , HTTPS : 443 , FTP : 21 , Telnet : 23 ,,...
  - 잘 알려진 포트 번호는 1~1023 사이의 수를 사용하므로 우리가 새로운 애플리케이션 프로토콜을 정의할 때는 이 범위를 피해서 정하는 것이 좋다.

- 서버에서 접속된 다수의 응용프로그램을 구분하기 위한 번호(예약된 번호 0~1023, 1024~49151중 하나 선택)

#### 4. TCP/IP의 동작 과정

- 서버/ 클라이언트 방식으로 동작한다.
  - ex) 웹 서버와 웹 브라우저, FTP 서버와 FTP 클라이언트 , SMTP 메일 서버와 메일 클라이언트 등
- TCP/IP 통신을 위해서는 먼저
  - 서버가 서비스를 시작해야 한다. 클라이언트가 접속해올 수 있도록 준비를 하는 것이다.
  - 서버가 준비되면 클라이언트는 서버에 접속을 시도한다.
  - 서버가 이 접속 시도를 수락하면 서버와 클라이언트는 동등한 입장에서 데이터를 주고 받을 수 있게 된다.
  - 용무가 끝나면 접속을 종료한다. 종료 요청은 클라이언트/서버 둘다 할 수 있다.



##### UDP 서버와 클라이언트

- ip 주소와 port 번호를 알면 데이터 전송 가능
- UdpClient 클래스 하나로 사용 가능 (서버와 클라이언트 모두 사용)
- 그룹 처리 UdpClient.JoinMulticatst() 사용

 